---
title: (spring) MyBatis
excerpt: "MyBatis ì„¤ì •"
categories:
  - Spring 
tags:
  - Spring
  - eclipse
last_modified_at: 2020-05-30
---

ğŸ’¼ğŸ“ğŸ”‘â° ğŸ“™ğŸ““ğŸ“˜ğŸ“’ğŸ“

```
ì˜ˆì œ í”„ë¡œì íŠ¸ : mvc-demoweb-starter
```
# ğŸ’¼ MyBatis?

**ê°ì²´ì™€ í…Œì´ë¸”ì„ ë§¤í•‘í•˜ëŠ” ORMê³¼ëŠ” ë‹¤ë¥´ê²Œ ê°ì²´ì™€ SQLë¬¸ì„ ë§¤í•‘í•˜ëŠ” í”„ë ˆì„ì›Œí¬**
- ë…ìì ì¸ ì§ˆì˜ ì–¸ì–´ë¥¼ ì§€ì›í•˜ì§€ ì•Šê³  SQL ì‚¬ìš© 

**â–ª ì¥ì ** 
- ì €ìˆ˜ì¤€ JDBC ì½”ë“œì˜ ë³µì¡ì„± ì œê±° 
-  ì¹œê·¼í•œ SQL ê¸°ë°˜ìœ¼ë¡œ ì´ˆê¸° í•™ìŠµê³¡ì„  ì™„ë§Œ 
-  ê¸°ì¡´ ë°ì´í„°ë² ì´ìŠ¤ì™€ í˜¸í™˜ì„± ë†’ìŒ 
-  Spring í”„ë ˆì„ì›Œí¬ì™€ í†µí•© ê¸°ëŠ¥ ì œê³µ 
-  ì„±ëŠ¥ ìš°ìˆ˜

## ğŸ“ MyBatis í´ë˜ìŠ¤
1. `SqlSessionFactoryBuilder` : SqlSessionFactoryë¥¼ ìƒì„±í•˜ëŠ” ê°ì²´,mybatis-config.xml ì„¤ì • íŒŒì¼ ì‚¬ìš© 
2. `SqlSessionFactory` : SqlSessionì„ ìƒì„±í•˜ëŠ” ê°ì²´
3. `SqlSession` : SQLì„ ì‹¤í–‰í•˜ëŠ” ê°ì²´ Mapper íŒŒì¼ì˜ ë§¤í•‘ ì •ë³´ ì‚¬ìš©

## ğŸ“ MyBatis ì—°ë™ ìŠ¤í”„ë§ í´ë˜ìŠ¤
1. `SqlSessionFactoryBean`
- SqlSessionFactoryBuilderë¥¼ ì‚¬ìš©í•´ì„œ SqlSessionFactory ìƒì„±
- ìŠ¤í”„ë§ì˜ FactoryBean ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ â†’ getObject ë©”ì„œë“œ ì¬ì •ì˜ë¥¼ í†µí•´ SqlSessionFactory ê°ì²´ ë°˜í™˜
2. `SqlSessionTemplate `: SqlSessionì„ Wrappingí•œ ê°ì²´

### ğŸ”‘ FactoryBeanì´ë€?
`FactoryBean`: 
- newë¡œ ë§Œë“¤ìˆ˜ ì—†ëŠ” ê²ƒë“¤ì„ 
- FactoryBeanìœ¼ë¡œ ë§Œë“¤ì–´ ì˜ì¡´ ê°ì²´ë“¤ì„ ì „ë¶€ ë§Œë“¤ì–´ì£¼ëŠ” SPRING ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.


# ğŸ’¼ MyBatis - ìŠ¤í”„ë§ ì—°ë™ ì„¤ì •
- [mvnrepository ì ‘ì†](https://mvnrepository.com/) 

## ğŸ“ 1. ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ë“±ë¡ (pom.xml) 
- `MyBatis Spring`,`MyBatis` ë³µì‚¬ pom.xmlì— ë“±ë¡ ì‘ì—…
~~~xml
<!-- https://mvnrepository.com/artifact/org.mybatis/mybatis -->
<dependency>
	<groupId>org.mybatis</groupId>
	<artifactId>mybatis</artifactId>
	<version>3.5.4</version>
</dependency>
<!-- ë§ˆì´ë°”í‹°ìŠ¤ì™€ ìŠ¤í”„ë§ì„ ì—°ë™í•˜ëŠ” íŒ¨í‚¤ì§€ -->
<dependency>
	<groupId>org.mybatis</groupId>
	<artifactId>mybatis-spring</artifactId>
	<version>2.0.4</version>
</dependency>
~~~

## ğŸ“ 2. mybatis-config.xml ì„¤ì • íŒŒì¼ ì‘ì„±
- `/resources/mybatis-config.xml` : íŒŒì¼ ìƒì„±
- mapper.xml íŒŒì¼ë“¤ì„ ë“±ë¡ í•´ë†“ëŠ” ì‘ì—…

~~~xml
<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE configuration
	PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd">

<configuration>
	<!--mapper.xmlì— ë“¤ì–´ê°ˆ voì˜ ë³„ì¹­ ì„¤ì • -->
	<typeAliases> 
		<typeAlias type="com.demoweb.vo.Member" alias="Member"/>
	</typeAliases>
	<!-- SQL ë§¤í•‘ íŒŒì¼ ê²½ë¡œ ì§€ì • -->
	<mappers>
		<mapper resource="com/demoweb/mapper/MemberMapper.xml"/>
	</mappers>
</configuration>
~~~

### ì„¤ì •íŒŒì¼ ì£¼ìš” êµ¬ì„± ìš”ì†Œ
- `mappers`: SQL ë§¤í•‘ íŒŒì¼ ê²½ë¡œ ì§€ì •
- `properties` : ë‹¤ë¥¸ ìš”ì†Œì—ì„œ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆë„ë¡ ì„¤ì • ì •ë³´ë¥¼ ë¶„ë¦¬ ì •ì˜
- `typeAliases `: íŒ¨í‚¤ì§€ëª…ì„ í¬í•¨í•˜ëŠ” í´ë˜ìŠ¤ì˜ ì „ì²´ ê²½ë¡œëª… ëŒ€ì‹  ì‚¬ìš©í•  ë³„ëª… ì§€ì •



## ğŸ“ 3. mapper.xml íŒŒì¼ ì‘ì„±
- /resources/íŒ¨í‚¤ì§€ê²½ë¡œ/â—‹â—‹â—‹â—‹Mapper.xml íŒŒì¼ ìƒì„±
- Controller ê°¯ìˆ˜ë§Œí¼? ë­ ììœ ì´ê¸´ í•˜ë‹¤.
- SQLë¬¸ì´ ì‘ì„± ë¶€ë¶„
- VO ê°ì²´ì™€ ë°ì´í„°ë² ì´ìŠ¤ TABLEì— ë³€í™˜ì‘ì—…ì„ í•´ì£¼ëŠ” íŒŒì¼ì´ë‹¤.

~~~xml
<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.demoweb.mapper.MemberMapper">
	<select id="selectMemberByIdAndPasswd" parameterType="hashmap" resultType="Member">
		SELECT memberid, email, usertype, active, regdate  
		FROM member   
		WHERE memberid = #{memberId} AND passwd = #{passwd}
	</select>
	
	<insert id="insertMember" parameterType="Member">
		INSERT INTO member (memberid, passwd, email)  
		VALUES (#{memberId}, #{passwd}, #{email})
	</insert>
	<update id="updateMember" parameterType="Member">
		UPDATE member 
		SET passwd = #{passwd}, email = #{email}
		WHERE memberid = #{memberId}
	</update>
	
</mapper>
~~~

## ğŸ“ 4. root-contex.xmlì— ë¹ˆ ì¶”ê°€
- MyBatis ì„¤ì • ì‘ì—…
~~~xml
<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
	<property name="dataSource" ref="dataSource"/>
	<property name="configLocation" value="classpath:mybatis-config.xml"/>
</bean>
<bean id="sqlSessionTemplate" class="org.mybatis.spring.SqlSessionTemplate">
	<constructor-arg ref="sqlSessionFactory"/>
</bean>
~~~
- MyBatisë¥¼ ì‚¬ìš©í•  DAOì— ì˜ì¡´ì„± ì£¼ì…
~~~xml
<bean id="memberDao"
		class="com.demoweb.dao.MemberDao">
	<property name="sqlSessionTemplate" ref="sqlSessionTemplate"></property>
</bean>
~~~
- root-context.xmlíŒŒì¼ì—ì„œ  Namesspaces í… í´ë¦­í›„ mybatis ì„ íƒí›„ ë§ˆì´ë°”í‹°ìŠ¤ì—ê²Œ ì•Œë ¤ì£¼ëŠ” ì‘ì—…
~~~xml
<mybatis-spring:scan base-package="com.demoweb.mapper"/>
~~~

## ğŸ“ 6. Mapper ì¸í„°í˜ì´ìŠ¤ ìƒì„±
![javaê²½ë¡œì— ìƒì„±, ì¸í„°í˜ì´ìŠ¤ëŠ” ê¼­ mapper.xml í´ë” êµ¬ì¡°ì™€ ë˜‘ê°™ì€ ê²½ë¡œë¡œ íŒ¨í‚¤ì§€ ê²½ë¡œë¥¼ ì¡ì•„ì•¼ í•œë‹¤!](/assets/img/common/2020-05-30-16-42-51.png)
~~~java
@Mapper
public interface MemberMapper {
	void insertMember(Member member);
	Member selectMemberByIdAndPasswd(HashMap<String, Object> params);
	void updateMember(Member member);
}
~~~
- Mapper ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ ê¼­ root-context.xmlì— ì»´í¬ë„ŒíŠ¸ ìŠ¤ì¼„ì´ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ ëœë‹¤!


## ğŸ“ 7. Daoì—ì„œ í˜¸ì¶œí•˜ëŠ” ì‘ì—…
- mapperì¸í„°í˜ì´ìŠ¤ë¥¼ ìë™ ì£¼ì…í•˜ë¼.

~~~java	
public class MemberDao {
	
	private SqlSessionTemplate sqlSessionTemplate;
	public void setSqlSessionTemplate(SqlSessionTemplate sqlSessionTemplate) {
		this.sqlSessionTemplate = sqlSessionTemplate;
	}
	
//TODO 2ë²ˆì§¸ ì‘ì—…
	@Autowired
	private MemberMapper memberMapper;

	public void insertMember(Member member) {
		memberMapper.insertMember(member);
	}
	
	public Member selectMemberByIdAndPasswd(String memberId, String passwd) {
		
		HashMap<String, Object> params = new HashMap<String, Object>();
		params.put("memberId", memberId);
		params.put("passwd", passwd);
		
		Member member = memberMapper.selectMemberByIdAndPasswd(params);
		return member; //ì¡°íšŒëœ ë°ì´í„°ë¥¼ ì €ì¥í•­ Member ê°ì²´ ë°˜í™˜
	}
	
	public void updateMember(Member member) {
		memberMapper.updateMember(member);
	}
}
~~~