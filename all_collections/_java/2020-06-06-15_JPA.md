---
title: (spring) JPA (Java Persistence API)
excerpt: "REST API μ„¤λ…"
categories:
  - Spring 
tags:
  - Spring
  - eclipse
last_modified_at: 2020-06-06
---

π’Όπ“π”‘β° π“™π““π“π“’π“

```
xml μμ  ν”„λ΅μ νΈ : spring-boot-demoweb2-starter
```
# π’Ό JPA λ€?
- μλ°” κ°μ²΄μ™€ λ°μ΄ν„°λ² μ΄μ¤ ν…μ΄λΈ” κ°„μ λ§¤ν•‘μ„ μ²λ¦¬ν•λ” ORM κΈ°μ  ν‘μ¤€
- JAP κµ¬ν„μ²΄ 
	+ JPA κΈ°μ  λ…μ„Έλ¥Ό κµ¬ν„ν• μ ν’ β†’ JPA Provider 
	+ ν•μ΄λ²„λ„¤μ΄νΈ, μ΄ν΄λ¦½μ¤λ§ν¬ λ“±
- μ¥μ  
	+ κ°λ°μ΄ νΈλ¦¬ν•λ‹¤ 
	+ λ°μ΄ν„°λ² μ΄μ¤μ— λ€ν• μΆ…μ†μ„± μ κ±° β†’ λ°μ΄ν„°λ² μ΄μ¤ μ ν’ μμ΅΄μ„± μ—†μ 
	+ μ μ§€λ³΄μκ°€ μ‰½λ‹¤.
- λ‹¨μ 
	+ ν•™μµκ³΅μ„ μ΄ κ°€νλ¥΄λ‹¤ 
	+ νΉμ • λ°μ΄ν„°λ² μ΄μ¤μ νΉν™”λ κΈ°λ¥ μ‚¬μ© μ ν• 
	+ κ°μ²΄μ§€ν–¥ μ„¤κ³„ ν•„μ”

# π’Ό Spring Data JPA
- μ¤ν”„λ§μ—μ„ JPAλ¥Ό μ‰½κ² μ‚¬μ©ν•  μ μλ„λ΅ μ§€μ›ν•λ” λΌμ΄λΈλ¬λ¦¬
- Spring Data JPAκ°€ μ κ³µν•λ” Repository μΈν„°νμ΄μ¤λ¥Ό μƒμ†ν•΄μ„ μ •ν•΄μ§„ κ·μΉ™μ— λ§κ² λ©”μ„λ“λ¥Ό μ‘μ„±ν•λ©΄ μλ™μΌλ΅ λ°μ΄ν„° μ—°λ™ μ½”λ“ μ™„μ„±
- λ‚΄λ¶€μ—μ„λ” μ‹¤μ  κΈ°λ¥μ„ λ‹΄λ‹Ήν•λ” JPA κµ¬ν„μ²΄λ΅ ν•μ΄λ²„λ„¤μ΄νΈ μ‚¬μ©
- ν•μ΄λ²„λ„¤μ΄νΈμ™€ κ°™μ€ ORM μ‚¬μ©μ— ν•„μ”ν• λ‹¤μ–‘ν• μ”κµ¬μ‚¬ν•­μ„ μ¶”μƒν™”ν•΄μ„ μƒλ€μ μΌλ΅ μ‰½κ² JPA μ‚¬μ© κ°€λ¥

## π“ Spring Data JPA κµ¬ν„

### π”‘ application.properties μ„¤μ •
~~~yml
server.port=8081

spring.mvc.view.prefix=/WEB-INF/views/
spring.mvc.view.suffix=.jsp

spring.datasource.hikari.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.hikari.jdbc-url=jdbc:mysql://211.197.18.246:3306/demoweb?serverTimezone=UTC
spring.datasource.hikari.username=devuser
spring.datasource.hikari.password=mariadb
spring.datasource.hikari.connection-test-query=SELECT 1

spring.jpa.database=mysql
spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect
spring.jpa.generate-ddl=true
spring.jpa.hibernate.ddl-auto=update
spring.jpa.hibernate.use-new-id-generator-mappings=false
~~~

### π”‘ DatabaseConfig.java λ³€κ²½
~~~java
@Bean
@ConfigurationProperties(prefix="spring.jpa")
public Properties hibernateConfig() {		
	return new Properties();
}
~~~

### π”‘ Application ν΄λμ¤ μμ •
~~~java
@EntityScan(basePackages = { "com.demoweb" })
@SpringBootApplication
public class SpringBootDemowebApplication {
~~~

### π”‘ Entity ν΄λμ¤ μ •μ
~~~java
@Entity
@Table(name = "tbl_board")
@Data
public class BoardEntity {

	@Id
	@GeneratedValue(strategy = GenerationType.AUTO)
	private int boardNo;
	@Column(nullable = false)
	private String title;
	@Column(nullable = false)
	private String writer;
	@Column(nullable = false)
	private String content;
	@Column
	@DateTimeFormat(pattern = "yyyy-MM-dd")
	private Date regDate = new Date();
	@Column
	private int readCount = 0;
	@Column
	private boolean deleted = false;
		
	@OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
	@JoinColumn(name = "boardNo")
	private Set<BoardAttachEntity> attachments;
	
	@OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
	@JoinColumn(name = "boardNo")
	private Set<BoardCommentEntity> comments;
}
~~~

## π“ Repository interface
- μ¤ν”„λ§ λ°μ΄ν„° JPAκ°€ μ κ³µν•λ” μΈν„°νμ΄μ¤λ΅ κΈ°λ¥ μμ¤€μ— λ”°λΌ 4κ°€μ§€ μΈν„°νμ΄μ¤ μ κ³µ
- κ° μΈν„°νμ΄μ¤λ¥Ό μƒμ†ν•λ” μΈν„°νμ΄μ¤λ¥Ό μ •μν•λ©΄ μΌμ •ν• ν¨ν„΄μ— λ”°λΌ λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™ λ©”μ„λ“λ¥Ό μλ™ μƒμ„±
- μλ™μΌλ΅ μƒμ„±λ λ©”μ„λ“λ΅ μ¶©μ΅±λμ§€ μ•λ” κΈ°λ¥μ€ μΌμ •ν• κ·μΉ™μ— λ”°λΌ λ©”μ„λ“λ¥Ό μ„ μ–Έν•  μ μμ
- JPA μ—μ„ μ κ³µν•λ” JPQL μ΄λ‚ λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ‚¬μ©ν•λ” SQLμ„ μ‚¬μ©ν•΄μ„ λ©”μ„λ“λ¥Ό λ§λ“λ” κ²ƒλ„ κ°€λ¥

<iframe frameborder="0" style="width:100%;height:363px;" src="https://app.diagrams.net/?lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1&title=Untitled%20Diagram.drawio#R7VfBcpswEP0aju1gBHZzTLHTNtPOpPGhTW4aawPqAMvIIkC%2BvsIsCEzjcZNJ7UMvHvatdrV6uw9hh4Vp9UnxPP6GAhLHc0XlsKXjef58YX4boG6BReC1QKSkaKGZBdbyCQh0CS2kgO1ooUZMtMzH4AazDDZ6hHGlsBwve8BkvGvOI5gA6w1PpugPKXRM6DzwreMzyCimrT3G5q0n5d1qOso25gLLAcRWDgsVom6f0iqEpCGvI6aNu3rG21emINPHBDz5F5fhvauuvjwsv9fR7XWUL97NKM1W192RQRgGyESlY4ww48nKoh8VFpmAJq1rLLvmK2JuwJkBf4HWNbWTFxoNFOs0IS9UUv9swt8HZN0NPMuKMu%2BMujMyrepBUGPeDX02bGd1ce35mkM9y1vHARZqAwfIotHVXEWgD6xjfXeNLABTMPWYOAUJ1%2FJxXAenAY36dbaF5oG6%2BBcdpSIfeVLQTreQ41ZqpOTDXttONuSXsdSwzvmOhNLoedw1SgxKQ3WYy%2BnZu4BO1%2FWeXQ7E5RMWD3TF3Deia%2Bb9F8DRAmBHCsB%2FpQAo9AalqdAOz4fx8PRv1i5FWxdF7c1FX8bLR4VNlBWqQpyTutxgrK6LP6gr%2BKfqCk6irtMrxT9SKcEprwp%2FMtA3PJJZdJmJtaHdPJ3xcHvzUw93MKHvOufnxNjeZcvY2122xrRfsu0L1%2F4fYKvf"></iframe>

### π”‘ Repository interface method
- CrudRepository μΈν„°νμ΄μ¤ κΈ°μ¤€ 
	+ `save(entity)`: μ§€μ •λ μ—”ν‹°ν‹° μ €μ¥ 
	+ `saveAll(entities)`: μ§€μ •λ μ—”ν‹°ν‹° λ©λ΅ μ €μ¥ 
	+ `findById(id)`: μ§€μ •λ μ•„μ΄λ””λ΅ μ‹λ³„λ μ—”ν‹°ν‹° λ°ν™ 
	+ `existsById(id)`: μ§€μ •λ μ•„μ΄λ””λ΅ μ‹λ³„λ μ—”ν‹°ν‹° μ΅΄μ¬ μ—¬λ¶€ λ°ν™ 
	+ `findAll()`: λ¨λ“  μ—”ν‹°ν‹° λ°ν™ 
	+ `findAllById(ids)`: μ§€μ •λ μ•„μ΄λ”” λ©λ΅μ— μν•΄ μ‹λ³„λ λ¨λ“  μ—”ν‹°ν‹° λ°ν™ 	
	+ `count()`: μ‚¬μ© κ°€λ¥ν• μ—”ν‹°ν‹° κ°μ λ°ν™ 
	+ `deleteById(id)`: μ§€μ •λ μ•„μ΄λ””λ΅ μ‹λ³„λ μ—”ν‹°ν‹° μ‚­μ  
	+ `delete(entity)`: μ§€μ •λ μ—”ν‹°ν‹° μ‚­μ  
	+ `deleteAll(entities)`: μ§€μ •λ μ—”ν‹°ν‹° λ©λ΅ μ‚­μ  
	+ `deleteAll()`: λ¨λ“  μ—”ν‹°ν‹° μ‚­μ 