---
title: (spring) JPA (Java Persistence API)
excerpt: "ìë°” ê°ì²´ì™€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ê°„ì˜ ë§¤í•‘ì„ ì²˜ë¦¬í•˜ëŠ” ORM ê¸°ìˆ  í‘œì¤€"
categories:
  - Spring 
tags:
  - Spring
  - eclipse
last_modified_at: 2020-06-06
---

ğŸ’¼ğŸ“ğŸ”‘â° ğŸ“™ğŸ““ğŸ“˜ğŸ“’ğŸ“

```
xml ì˜ˆì œ í”„ë¡œì íŠ¸ : spring-boot-demoweb2-starter
```
# ğŸ’¼ JPA ë€?
- ìë°” ê°ì²´ì™€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ê°„ì˜ ë§¤í•‘ì„ ì²˜ë¦¬í•˜ëŠ” ORM ê¸°ìˆ  í‘œì¤€
- JAP êµ¬í˜„ì²´ 
	+ JPA ê¸°ìˆ  ëª…ì„¸ë¥¼ êµ¬í˜„í•œ ì œí’ˆ â†’ JPA Provider 
	+ í•˜ì´ë²„ë„¤ì´íŠ¸, ì´í´ë¦½ìŠ¤ë§í¬ ë“±
- ì¥ì  
	+ ê°œë°œì´ í¸ë¦¬í•˜ë‹¤ 
	+ ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì¢…ì†ì„± ì œê±° â†’ ë°ì´í„°ë² ì´ìŠ¤ ì œí’ˆ ì˜ì¡´ì„± ì—†ìŒ 
	+ ìœ ì§€ë³´ìˆ˜ê°€ ì‰½ë‹¤.
- ë‹¨ì 
	+ í•™ìŠµê³¡ì„ ì´ ê°€íŒŒë¥´ë‹¤ 
	+ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì˜ íŠ¹í™”ëœ ê¸°ëŠ¥ ì‚¬ìš© ì œí•œ 
	+ ê°ì²´ì§€í–¥ ì„¤ê³„ í•„ìš”

# ğŸ’¼ Spring Data JPA
- ìŠ¤í”„ë§ì—ì„œ JPAë¥¼ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
- Spring Data JPAê°€ ì œê³µí•˜ëŠ” Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•´ì„œ ì •í•´ì§„ ê·œì¹™ì— ë§ê²Œ ë©”ì„œë“œë¥¼ ì‘ì„±í•˜ë©´ ìë™ìœ¼ë¡œ ë°ì´í„° ì—°ë™ ì½”ë“œ ì™„ì„±
- ë‚´ë¶€ì—ì„œëŠ” ì‹¤ì œ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” JPA êµ¬í˜„ì²´ë¡œ í•˜ì´ë²„ë„¤ì´íŠ¸ ì‚¬ìš©
- í•˜ì´ë²„ë„¤ì´íŠ¸ì™€ ê°™ì€ ORM ì‚¬ìš©ì— í•„ìš”í•œ ë‹¤ì–‘í•œ ìš”êµ¬ì‚¬í•­ì„ ì¶”ìƒí™”í•´ì„œ ìƒëŒ€ì ìœ¼ë¡œ ì‰½ê²Œ JPA ì‚¬ìš© ê°€ëŠ¥

## ğŸ“ Spring Data JPA êµ¬í˜„

### ğŸ”‘ application.properties ì„¤ì •
~~~yml
server.port=8081

spring.mvc.view.prefix=/WEB-INF/views/
spring.mvc.view.suffix=.jsp

spring.datasource.hikari.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.hikari.jdbc-url=jdbc:mysql://211.197.18.246:3306/demoweb?serverTimezone=UTC
spring.datasource.hikari.username=devuser
spring.datasource.hikari.password=mariadb
spring.datasource.hikari.connection-test-query=SELECT 1

spring.jpa.database=mysql
spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect
spring.jpa.generate-ddl=true
spring.jpa.hibernate.ddl-auto=update
spring.jpa.hibernate.use-new-id-generator-mappings=false
~~~

### ğŸ”‘ DatabaseConfig.java ë³€ê²½
~~~java
@Bean
@ConfigurationProperties(prefix="spring.jpa")
public Properties hibernateConfig() {		
	return new Properties();
}
~~~

### ğŸ”‘ Application í´ë˜ìŠ¤ ìˆ˜ì •
~~~java
@EntityScan(basePackages = { "com.demoweb" })
@SpringBootApplication
public class SpringBootDemowebApplication {
~~~

### ğŸ”‘ Entity í´ë˜ìŠ¤ ì •ì˜
~~~java
@Entity
@Table(name = "tbl_board")
@Data
public class BoardEntity {

	@Id
	@GeneratedValue(strategy = GenerationType.AUTO)
	private int boardNo;
	@Column(nullable = false)
	private String title;
	@Column(nullable = false)
	private String writer;
	@Column(nullable = false)
	private String content;
	@Column
	@DateTimeFormat(pattern = "yyyy-MM-dd")
	private Date regDate = new Date();
	@Column
	private int readCount = 0;
	@Column
	private boolean deleted = false;
		
	@OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
	@JoinColumn(name = "boardNo")
	private Set<BoardAttachEntity> attachments;
	
	@OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
	@JoinColumn(name = "boardNo")
	private Set<BoardCommentEntity> comments;
}
~~~


## ğŸ“ Repository interface
- ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ì œê³µí•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ê¸°ëŠ¥ ìˆ˜ì¤€ì— ë”°ë¼ 4ê°€ì§€ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
- ê° ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í•˜ë©´ ì¼ì •í•œ íŒ¨í„´ì— ë”°ë¼ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ë©”ì„œë“œë¥¼ ìë™ ìƒì„±
- ìë™ìœ¼ë¡œ ìƒì„±ëœ ë©”ì„œë“œë¡œ ì¶©ì¡±ë˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì€ ì¼ì •í•œ ê·œì¹™ì— ë”°ë¼ ë©”ì„œë“œë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆìŒ
- JPA ì—ì„œ ì œê³µí•˜ëŠ” JPQL ì´ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” SQLì„ ì‚¬ìš©í•´ì„œ ë©”ì„œë“œë¥¼ ë§Œë“œëŠ” ê²ƒë„ ê°€ëŠ¥

<iframe frameborder="0" style="width:100%;height:363px;" src="https://app.diagrams.net/?lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1&title=Untitled%20Diagram.drawio#R7VfBcpswEP0aju1gBHZzTLHTNtPOpPGhTW4aawPqAMvIIkC%2BvsIsCEzjcZNJ7UMvHvatdrV6uw9hh4Vp9UnxPP6GAhLHc0XlsKXjef58YX4boG6BReC1QKSkaKGZBdbyCQh0CS2kgO1ooUZMtMzH4AazDDZ6hHGlsBwve8BkvGvOI5gA6w1PpugPKXRM6DzwreMzyCimrT3G5q0n5d1qOso25gLLAcRWDgsVom6f0iqEpCGvI6aNu3rG21emINPHBDz5F5fhvauuvjwsv9fR7XWUL97NKM1W192RQRgGyESlY4ww48nKoh8VFpmAJq1rLLvmK2JuwJkBf4HWNbWTFxoNFOs0IS9UUv9swt8HZN0NPMuKMu%2BMujMyrepBUGPeDX02bGd1ce35mkM9y1vHARZqAwfIotHVXEWgD6xjfXeNLABTMPWYOAUJ1%2FJxXAenAY36dbaF5oG6%2BBcdpSIfeVLQTreQ41ZqpOTDXttONuSXsdSwzvmOhNLoedw1SgxKQ3WYy%2BnZu4BO1%2FWeXQ7E5RMWD3TF3Deia%2Bb9F8DRAmBHCsB%2FpQAo9AalqdAOz4fx8PRv1i5FWxdF7c1FX8bLR4VNlBWqQpyTutxgrK6LP6gr%2BKfqCk6irtMrxT9SKcEprwp%2FMtA3PJJZdJmJtaHdPJ3xcHvzUw93MKHvOufnxNjeZcvY2122xrRfsu0L1%2F4fYKvf"></iframe>

### ğŸ”‘ Repository interface method
- CrudRepository ì¸í„°í˜ì´ìŠ¤ ê¸°ì¤€ 
	+ `save(entity)`: ì§€ì •ëœ ì—”í‹°í‹° ì €ì¥ 
	+ `saveAll(entities)`: ì§€ì •ëœ ì—”í‹°í‹° ëª©ë¡ ì €ì¥ 
	+ `findById(id)`: ì§€ì •ëœ ì•„ì´ë””ë¡œ ì‹ë³„ëœ ì—”í‹°í‹° ë°˜í™˜ 
	+ `existsById(id)`: ì§€ì •ëœ ì•„ì´ë””ë¡œ ì‹ë³„ëœ ì—”í‹°í‹° ì¡´ì¬ ì—¬ë¶€ ë°˜í™˜ 
	+ `findAll()`: ëª¨ë“  ì—”í‹°í‹° ë°˜í™˜ 
	+ `findAllById(ids)`: ì§€ì •ëœ ì•„ì´ë”” ëª©ë¡ì— ì˜í•´ ì‹ë³„ëœ ëª¨ë“  ì—”í‹°í‹° ë°˜í™˜ 	
	+ `count()`: ì‚¬ìš© ê°€ëŠ¥í•œ ì—”í‹°í‹° ê°œìˆ˜ ë°˜í™˜ 
	+ `deleteById(id)`: ì§€ì •ëœ ì•„ì´ë””ë¡œ ì‹ë³„ëœ ì—”í‹°í‹° ì‚­ì œ 
	+ `delete(entity)`: ì§€ì •ëœ ì—”í‹°í‹° ì‚­ì œ 
	+ `deleteAll(entities)`: ì§€ì •ëœ ì—”í‹°í‹° ëª©ë¡ ì‚­ì œ 
	+ `deleteAll()`: ëª¨ë“  ì—”í‹°í‹° ì‚­ì œ

## ğŸ“ Query Method Pattern
- ë©”ì„œë“œ ì´ë¦„ì€ findâ€¦By, readâ€¦By, queryâ€¦By, countâ€¦By, getâ€¦Byë¡œ ì‹œì‘
- ì²« ë²ˆì§¸ By ë’¤ìª½ì€ ì»¬ëŸ¼ ì´ë¦„ìœ¼ë¡œ êµ¬ì„± â†’ ê²€ìƒ‰ ì¡°ê±´
- And ë˜ëŠ” Or í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ì„œ ë‘ ê°œ ì´ìƒì˜ ì†ì„±ì„ ì¡°í•©
- ë‹¤ì–‘í•œ ë¹„êµ ì—°ì‚°ìë¥¼ ì¡°í•©í•´ì„œ í•„ìš”í•œ ì¿¼ë¦¬ ì‘ì„±

### ì‚¬ìš© ì˜ˆ
~~~java
public interface BoardRepository extends CrudRepository<BoardEntity, Integer> {
	
	@Query(
		value = "SELECT * FROM tbl_board b ORDER BY b.board_no DESC LIMIT :from, :count",
		nativeQuery = true
	)
	List<BoardEntity> findAllWithPaging(@Param("from") int from, @Param("count") int count);

	@Query(
		"SELECT ba FROM BoardAttachEntity ba WHERE ba.attachNo = :attachNo"
	)
	BoardAttachEntity findBoardAttachByAttachNo(@Param("attachNo") int attachNo);

	@Query(
		value = "UPDATE tbl_board SET read_count = read_count + 1 WHERE board_no = :boardNo",
		nativeQuery = true
	)
	void updateBoardReadCount(@Param("boardNo") int boardNo);	
}
~~~

> ì„±ëŠ¥ë©´ìœ¼ë¡œë§Œ ë´¤ì„ ë•Œ mybatisê°€ ë” ë¹ ë¥´ê¸´í•˜ë‹¤.